{% extends 'help_desk_base.html' %}

{% block body_content %}
    <form action="{{ submit_url }}" method="post">
        <div class="centered margin-bottom-10">
            <h5>Scan ID to Sign In</h5>
        </div>
    </form>

    <table id="student-attendance" class="table table-striped table-bordered">
        <tr>
            <th data-toggle="tooltip" data-placement="top" title="Student Name">Name</th>
            <th data-toggle="tooltip" data-placement="top" title="Shift Number">Shift Number</th>
            <th data-toggle="tooltip" data-placement="top" title="Time Signed Into Session">Time In</th>
            <th data-toggle="tooltip" data-placement="top" title="Time Signed Out Of Session">Time Out</th>
        </tr>
        <tr>
            <td>Micah Weiberg</td>
            <td>1</td>
            <td>12:30 PM</td>
            <td><a class="btn btn-primary sign-out" href="#">Sign Out</a></td>
        </tr>
        <tr>
            <td>Micah Weiberg</td>
            <td>2</td>
            <td>6:00 PM</td>
            <td><a class="btn btn-primary sign-out" href="#">Sign Out</a></td>
        </tr>
    </table>
    <script>
        $(document).ready(function(){
            let input = "";
            $(document).on('keydown', function(key){
                if(key.keyCode == 13){
                    let url = "{{ url_for('ShiftsView:verify_scanner') }}";
                    let d = new Date($.now());
                    let time = d.getHours()+":"+d.getMinutes();

                    let scannedInput = {
                        'scan': input,
                        'time': time
                    };
                    $.post(url, scannedInput, function(success){
                        if(success != 'failed'){
                            alert("Signed in at "+time);
                        }else{
                            alert('Failed');
                            input = "";
                        }
                    });
                }else{
                    input = input + key.key;
                }
            });
            $(".btn.btn-primary.sign-out").click(function() {
                // let d = new Date($.now())
                // let time = d.getHours()+":"+d.getMinutes();

                let input_data = {
                    // 'time': time
                };
                $.post('/student_employees/timestamp', input_data, function(output_data) {
                    alert("Clocked");
                });
            });
        });
    </script>
{% endblock %}